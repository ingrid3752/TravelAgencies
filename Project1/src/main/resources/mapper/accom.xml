<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="mapper.AccomMapper">

	 <resultMap type="Accom" id="accomMap">
        <id column="accom_code" property="accomCode"/>
        <result column="accom_name" property="accomName"/>
        <result column="accom_phone" property="accomPhone"/>
        <result column="location" property="location"/>
        <result column="price" property="price"/>
    </resultMap>

    <resultMap type="AccomReservation" id="accomReservationMap">
        <id column="reservation_id" property="reservationId"/>
        <result column="mem_code" property="memCode"/>
        <result column="accom_code" property="accomCode"/>
        <result column="accom_name" property="accomName"/>
        <result column="start_date" property="startDate"/>
        <result column="end_date" property="endDate"/>
        <result column="seats" property="seats"/>
    </resultMap>

    <resultMap type="AccomFavorites" id="accomFavoritesMap">
        <id column="favorite_id" property="favoriteId"/>
        <result column="mem_code" property="memCode"/>
        <result column="accom_id" property="accomId"/>
        <result column="date_added" property="dateAdded"/>
    </resultMap>
    
    <!-- 숙소 예약 추가 -->
    <insert id="insertReservation" parameterType="AccomReservation">
    INSERT INTO accom_reservation (mem_code, accom_code, accom_name, start_date, end_date, seats)
    VALUES (#{memCode}, #{accomCode}, #{accomName}, #{startDate}, #{endDate}, #{seats})
	</insert>
    
    <!-- 예약 내역 조회 -->
	<select id="reservationList" resultMap="accomReservationMap">
   	SELECT r.reservation_id, r.accom_name, r.start_date, r.end_date, r.seats
    FROM accom_reservation r
    JOIN accom a ON r.accom_code = a.accom_code
    WHERE r.mem_code = #{memCode}
	</select>
    

   <!-- 시작 날짜 수정 -->
	<update id="updateStartDate" parameterType="AccomReservation">
    	UPDATE accom_reservation
    	SET start_date = #{startDate}, seats = #{seats}
    	WHERE reservation_id = #{reservationId} AND mem_code = #{memCode}
	</update>

	<!-- 종료 날짜 수정 -->
	<update id="updateEndDate" parameterType="AccomReservation">
   		UPDATE accom_reservation
    	SET end_date = #{endDate}, seats = #{seats}
    	WHERE reservation_id = #{reservationId} AND mem_code = #{memCode}
	</update>


    <!-- 예약 내역 삭제 -->
    <delete id="deleteReservation" parameterType="int">
   		DELETE FROM accom_reservation
    	WHERE reservation_id = #{reservationId} AND mem_code = #{memCode}
	</delete>


	 
</mapper>